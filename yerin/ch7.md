## 7-1 바벨 실행 및 설정하기

### 1. 바벨을 실행하는 여러 가지 방법

* @bable/cil로 실행하기
  * 바벨6까지는 .balbelrc파일로 설정값을 관리
  * 바벨7부터는 bable.config.js 파일로 관리하는 것을 추천
* 웹팩에서 bable-loader로 실행하기
  * 웹팩의 bable-loader로 실행
  * 프로젝트 루트에 webpack.config.js 파일을 만들고 코드 입력
* @bable/core를 직접 실행하기
  * 위에 두개 모드 @bable/core를 이용해서 바벨 실행
  * 직접 @bable/core를 사용하여 코드 작성할 수 있음
  * 자유도가 높다는 장점이 있음
  * 바벨 컴파일 시 거치는 3단계
    * 파싱 단계 : 입력된 코드로부터 AST를 생성한다.
    * 변환 단계 : AST를 원하는 형태로 변환한다,
    * 생성 단계 : AST를 코드로 출력한다.
* @bable/register로 실행하기 - 이 경우는 많지 않음



#### 2.확장성과 유연성을 고려한 바벨 설정 방법

* extends 속성으로 다른 설정 파일 가져오기
  * 다른 설정 파일을 가져와서 확장할 수 있음
  * .babelrc 파일을 만들고 실행
    * bable.config.js 파일을 만들지 않은 이유
* env, overrides 
  * 환경별 또는 파일별로 다른 설정을 적용할 수 있음



#### 3. 전체 설정 파일과 지역 설정 파일

* 전체 설정 파일

  * bable.config.js

* 지역 설정 파일

  * .babelrc, babelrc.js

  * package.json



#### 4. 바벨과 폴리필

* 폴리필 : 런타임에 기능을 주입하는 것
  * 런타임에 기능이 존재하는지 검사해서 기능이 없는 경우에만 주입
  * 바벨을 사용하더라도 폴리필에 대한 설정을 별도로 해야한다.
* 폴리필을 주입하는 여러 방법
  * @babel/polyfill모듈의 모든 폴리필 사용하기
    * 모든 폴리필을 가져올 수 있지만 번들 커질 수 있음
  * core-js 모듈에서 필요한 폴리필만 가져오기
    * 번들 파일 크기 줄일 수 있음
    * 번들 파일 크기에 민감한 프로젝트에 적합
  * @babel/preset-env 프리셋 이용하기
    * 실행 환경에 따라 자동으로 필요한 기능 주입





## 2. 바벨 플러그인 제작하기

#### 1. AST 구조 들여다보기

* 바벨은 문자열로 입력되는 코드를 AST라는 구조체로 만들어서 처리한다.
* 플러그인에서는 AST를 기반으로 코드를 변경한다.
* TODO... astexplorer 사이트에서 코드를 작성해 보고 그 코드로부터 만들어진 ast확인해보기



#### 2. 바벨 플러그인의 기본 구조





## 3. 웹팩 초급편

웹팩은 모듈 번들러다. 

모듈 - 각 리소스 파일

번들 -  웹팩 실행 후에 나오는 결과 파일

하나의 번들 파일 = 여러 모듈

* 웹팩이 필요한 이유
  * 스크립트로 파일을 가져올 때
    * 주솟값에 오타가 있거나
    * unpkg 사이트에 장애가 있거나
    * 스크립트 테그로 가져온 변수가 필요없어져 제거하거나 할때 문제가 발생



#### 1. 웹팩 실행하기

* webpack-cli를 이용하여 실행하면 dist 폴더가 만들어지고 그 밑에 main.js 번들 파일이 생성된다.

  이때 main.js는 index.js 모듈과 util.js 모듈이 합쳐진것

* 설정 파일 이용하기

  * 프로젝트 루트에 webpack.config.js 파일을 만들고
  * TODO... 웹팩 생성한 번들 파일 내용 톱아보기



#### 2. 로더 사용하기

* 모듈을 입력으로 받아서 원하는 형태로 변환한 후 새로운 모듈을 출력해 주는 함수

* 자바스크립트 파일 처리하기

  * babel/loader @babel/core @babel/preset-react react react-dom 이용

  * 루트에 babel.config.js 파일 만들고 @babel/preset-react 프리셋 사용하도록 설정
  * webpack.config.js 파일을 만들고 babel-loader설정

* css 파일 처리하기

  * css-loader style-loader 이용
  * webpack.config.js 설정

* 기타 파일 처리

  * file-loader raw-loader
  * webpack.config.js 설정

* 이미지 파일의 요청 횟수 줄이기

  * 이미지 파일을 번들 파일에 포함
  * 크기가 커지만 자바스크립트가 늦게 실행됨(작은 이미지 파일만 추천)
  * url-loader 이용



#### 3. 플러그인 사용하기

* 플러그인은 웹팩이 실행되는 전체 과정에 개입할 수 있다
* html-webpack-plugin
  * chunkhask 옵션을 설정해도 html파일 내용 수정 안해도 됨
  * 웹팩을 실행할 때마다 dist 폴더를 정리한다
  * 이전에 생성된 번들 파일을 정리하는 용도로 사용
* DefinePlugin
  * 모듈 내부에 있는 문자열을 대체해 줌
  * 웹팩에 내장된 플러그인이라 별도 설치 ㄴㄴ..
* ProvidePlugin
  * 미리 설정한 모듈을 자동으로 등록
  * 웹팩이 기본으로 포함 설치 ㄴㄴ



